<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>í™”íˆ¬ë¡œ ë³´ëŠ” ì˜¤ëŠ˜ì˜ ìš´ì„¸ | í™”íˆ¬ ìš´ì„¸</title>

  <!-- OG -->
  <meta property="og:title" content="í™”íˆ¬ë¡œ ë³´ëŠ” ì˜¤ëŠ˜ì˜ ìš´ì„¸" />
  <meta property="og:description" content="í™”íˆ¬ í•œ ì¥ìœ¼ë¡œ ì•Œì•„ë³´ëŠ” ì˜¤ëŠ˜ì˜ ìš´ì„¸ì™€ í–‰ìš´" />
  <meta property="og:image" content="https://dummyimage.com/1200x630/0b1220/ffffff&text=Hwatu+Fortune" />
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1204894220949193" crossorigin="anonymous"></script>

  <!-- Favicon (SVG) -->
  <link rel="icon" href="data:image/svg+xml,
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
    <rect width='100' height='100' rx='20' fill='%230b1220'/>
    <text x='50' y='62' font-size='52' text-anchor='middle' fill='white'>ğŸƒ</text>
  </svg>">

  <style>
    :root{
      --bg:#0b1220;
      --card:#111827;
      --paper:#ffffff;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#111;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background: linear-gradient(180deg, #f9fafb 0%, #f3f4f6 100%);
      color:#111;
      min-height:100vh;
    }
    header{
      background: linear-gradient(135deg, #0b1220 0%, #1a2332 100%);
      color:#fff;
      padding:28px 16px;
      text-align:center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    header h1{ margin:0 0 8px; font-size:24px; letter-spacing:-0.3px; font-weight:800; }
    header p{ margin:0; opacity:0.9; font-size:14px; line-height:1.6; }

    main{ max-width:1000px; margin:0 auto; padding:24px 16px 32px; }

    .row{ display:grid; grid-template-columns: 1fr; gap:20px; }
    @media (min-width:900px){
      .row{ grid-template-columns: 1fr; align-items:start; }
    }
    
    .main-card-section{
      max-width:600px;
      margin:0 auto;
    }

    .panel{
      background:var(--paper);
      border:1px solid var(--line);
      border-radius:16px;
      padding:20px;
      box-shadow: 0 8px 24px rgba(17,24,39,0.08);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .panel:hover{
      box-shadow: 0 12px 32px rgba(17,24,39,0.12);
    }

    .hint{
      font-size:13px;
      color:var(--muted);
      line-height:1.7;
      margin:12px 0 0;
    }
    .hint b{
      color:#111;
      font-weight:700;
    }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; justify-content:center; }
    button{
      border:none;
      border-radius:12px;
      padding:12px 18px;
      font-weight:700;
      cursor:pointer;
      background:var(--bg);
      color:#fff;
      letter-spacing:-0.2px;
      transition: all 0.2s;
      font-size:14px;
    }
    button:hover:not(:disabled){
      transform:translateY(-2px);
      box-shadow: 0 4px 12px rgba(11,18,32,0.2);
    }
    button.secondary{
      background:#eef2ff;
      color:#111;
    }
    button.secondary:hover:not(:disabled){
      background:#e0e7ff;
    }
    button.ghost{
      background:#fff;
      color:#111;
      border:1px solid var(--line);
    }
    button.ghost:hover:not(:disabled){
      border-color:#9ca3af;
      background:#f9fafb;
    }
    button:disabled{
      opacity:0.55;
      cursor:not-allowed;
    }

    /* Card flip */
    .stage{ display:flex; justify-content:center; padding:8px 0 6px; }
    .flip{
      width:260px;
      height:360px;
      perspective: 1200px;
    }
    .flip-inner{
      width:100%;
      height:100%;
      position:relative;
      transform-style:preserve-3d;
      transition: transform .75s cubic-bezier(.2,.8,.2,1);
      border-radius:16px;
    }
    .flip.is-flipped .flip-inner{ transform: rotateY(180deg); }
    .face{
      position:absolute;
      inset:0;
      border-radius:16px;
      overflow:hidden;
      backface-visibility:hidden;
      border:1px solid rgba(229,231,235,0.9);
      box-shadow: 0 16px 30px rgba(0,0,0,0.12);
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .back{
      background: linear-gradient(135deg, #0b1220 0%, #111827 55%, #0b1220 100%);
      color:#fff;
      flex-direction:column;
      gap:10px;
    }
    .back .mark{
      width:86px;height:86px;border-radius:22px;
      border:1px solid rgba(255,255,255,0.18);
      display:flex;align-items:center;justify-content:center;
      font-size:44px;
      background: rgba(255,255,255,0.06);
    }
    .back .txt{ font-weight:800; letter-spacing:-0.2px; }
    .front{
      transform: rotateY(180deg);
      background:#fff;
    }
    .front img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }
    .front .fallback{
      padding:18px;
      text-align:center;
      color:#111;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border:1px solid var(--line);
      border-radius:999px;
      font-size:13px;
      color:#111;
      background:#fff;
      font-weight:600;
    }
    .badges{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:8px; }

    .result-title{ margin:16px 0 0; text-align:center; font-size:20px; font-weight:800; letter-spacing:-0.3px; color:#111; }
    .result-sub{ margin:12px auto 0; text-align:center; max-width:48ch; color:#111; line-height:1.7; font-size:15px; }
    .result-sub small{ color:var(--muted); display:block; margin-top:8px; }

    .info-section{
      background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:20px;
      margin-top:16px;
    }
    .info-section-title{
      font-size:15px;
      font-weight:800;
      color:#111;
      margin-bottom:12px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .info-section-desc{
      font-size:14px;
      line-height:1.7;
      color:#374151;
      margin-bottom:16px;
    }
    .info-section-desc strong{
      color:#111;
      font-weight:700;
    }
    .kv{
      display:grid;
      grid-template-columns: 90px 1fr;
      gap:10px 12px;
      margin-top:16px;
      font-size:14px;
      color:#111;
    }
    .kv .k{ 
      color:var(--muted);
      font-weight:600;
      font-size:13px;
    }
    .kv .v{
      color:#111;
      line-height:1.6;
    }
    .kv .v strong{
      color:#0b1220;
      font-weight:700;
    }

    .history{
      margin-top:12px;
      display:grid;
      gap:10px;
    }
    .h-item{
      border:1px solid var(--line);
      border-radius:12px;
      padding:14px;
      background:#fff;
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      transition: all 0.2s;
    }
    .h-item:hover{
      border-color:#9ca3af;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .h-item .left{ display:flex; flex-direction:column; gap:4px; }
    .h-item .date{ font-size:12px; color:var(--muted); }
    .h-item .name{ font-weight:800; letter-spacing:-0.2px; font-size:15px; }
    .h-item .tag{ font-size:12px; color:#111; border:1px solid var(--line); padding:6px 10px; border-radius:999px; background:#f9fafb; white-space:nowrap; font-weight:600; }

    footer{
      text-align:center;
      padding:24px 16px 32px;
      color:var(--muted);
      font-size:13px;
      max-width:1000px;
      margin:0 auto;
    }
    footer a{ 
      color:#111; 
      font-weight:800; 
      text-decoration:none;
      transition: color 0.2s;
    }
  footer a:hover{
    color:#0b1220;
    text-decoration:underline;
  }
  
    /* Share canvas (hidden) */
    #shareCanvas{
      display:none;
    }
  </style>
</head>

<body>
<header>
  <h1>í™”íˆ¬ë¡œ ë³´ëŠ” ì˜¤ëŠ˜ì˜ ìš´ì„¸</h1>
  <p>í™”íˆ¬ í•œ ì¥ìœ¼ë¡œ ë§¤ì¼ì„ ì—´ì–´ë³´ëŠ” ë§ˆë²• ê°™ì€ ìˆœê°„.<br/>ë‚˜ë§Œì˜ ìš´ì„¸ë¥¼ í™•ì¸í•˜ê³  ê³µìœ í•´ë³´ì„¸ìš”.</p>
</header>

<main>
  <div class="row">
    <!-- Main: Card -->
    <section class="panel main-card-section">
      <div class="stage">
        <div class="flip" id="flip">
          <div class="flip-inner">
            <div class="face back">
              <div class="mark">ğŸ´</div>
              <div class="txt">ì˜¤ëŠ˜ì˜ í™”íˆ¬ 1ì¥</div>
              <div style="font-size:13px;opacity:.85;">í´ë¦­í•´ì„œ ë’¤ì§‘ê¸°</div>
            </div>
            <div class="face front">
              <img id="cardImg" alt="í™”íˆ¬ ì¹´ë“œ" />
              <div class="fallback" id="fallback" style="display:none;">
                <div style="font-size:18px;font-weight:900;">ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨</div>
                <div style="margin-top:8px;color:var(--muted);line-height:1.45;">
                  <div>ê²½ë¡œ: <code id="imgPath"></code></div>
                  <div style="margin-top:6px;">assets/cards/1-1.png ~ 12-4.png í˜•ì‹ìœ¼ë¡œ ë§ì¶°ì£¼ì„¸ìš”</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="badges" id="badges" style="display:none;"></div>

          <div class="result-title" id="resultTitle">ì˜¤ëŠ˜ì˜ í™”íˆ¬ë¥¼ ë½‘ì•„ë³´ì„¸ìš”</div>
          <div class="result-sub" id="resultText">ë³´í†µ</div>

      <div class="actions">
        <button id="drawBtn">ì˜¤ëŠ˜ ìš´ì„¸ ë½‘ê¸°</button>
        <button class="secondary" id="copyBtn" disabled>ê²°ê³¼ ë³µì‚¬</button>
        <button class="secondary" id="shareImageBtn" disabled>ì´ë¯¸ì§€ë¡œ ê³µìœ </button>
      </div>

      <p class="hint">
        â€¢ ì–¸ì œë“ ì§€ ë½‘ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëœë¤ìœ¼ë¡œ ë‚˜ì˜¤ë¯€ë¡œ ì‚¬ëŒë§ˆë‹¤ ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.
      </p>
      
      <hr style="border:none;border-top:1px solid var(--line); margin:24px 0;" />
      
      <div class="badge">ğŸ•˜ ìµœê·¼ 7ì¼ ê¸°ë¡</div>
      <div class="history" id="history"></div>
    </section>

    <!-- Other Services -->
    <aside class="panel" style="max-width:400px; margin:20px auto 0;">
      <div class="actions" style="margin-top:0;">
        <a href="https://funnyfunny.cloud" target="_blank" rel="noopener" style="text-decoration:none; flex:1;">
          <button class="secondary" type="button" style="width:100%;">âœ¨ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ë³´ê¸°</button>
        </a>
      </div>
    </aside>
  </div>
</main>

<footer>
  <div>Â© funnyfunny.cloud Â· <a href="https://funnyfunny.cloud" target="_blank" rel="noopener">funnyfunny.cloud</a></div>
</footer>

<ins class="adsbygoogle"
     style="display:block; text-align:center; margin:20px auto; max-width:900px;"
     data-ad-client="ca-pub-1204894220949193"
     data-ad-slot="5145068706"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<script>
/* =========================
   1) í™”íˆ¬ ì¹´ë“œ ë°ì´í„°
   - ì´ë¯¸ì§€ íŒŒì¼ëª…: ./assets/hwatu/01.png ~ 48.png
   - ì´ë¯¸ ë„¤ê°€ ê°€ì§„ ì´ë¯¸ì§€ê°€ ìˆë‹¤ í–ˆìœ¼ë‹ˆ, íŒŒì¼ëª…ë§Œ ë§ì¶”ë©´ ë°”ë¡œ ëœ¸
========================= */
function pad2(n){ return String(n).padStart(2,'0'); }

// 12ê°œì›” x 4ì¥ = 48ì¥ (ë‹¨ìˆœ ì¸ë±ìŠ¤)
// ì‹¤ì œ ì„¸ë¶€ ì¹´ë“œ(ê´‘/ë /í”¼/íŠ¹ìˆ˜)ëŠ” tagsë¡œë§Œ êµ¬ë¶„í•´ë„ ì¶©ë¶„íˆ ì¬ë¯¸ê°€ ë‚¨
const months = [
  {m:1,  name:'1ì›”(ì†¡í•™)',  theme:'ì‹œì‘'},
  {m:2,  name:'2ì›”(ë§¤í™”)',  theme:'ê´€ê³„'},
  {m:3,  name:'3ì›”(ë²šê½ƒ)',  theme:'ê¸°íšŒ'},
  {m:4,  name:'4ì›”(ë“±ë‚˜ë¬´)',theme:'ì •ë¦¬'},
  {m:5,  name:'5ì›”(ì°½í¬)',  theme:'ìŠ¹ë¶€'},
  {m:6,  name:'6ì›”(ëª¨ë€)',  theme:'í’ìš”'},
  {m:7,  name:'7ì›”(ì‹¸ë¦¬)',  theme:'íšŒë³µ'},
  {m:8,  name:'8ì›”(ê³µì‚°)',  theme:'ì§‘ì¤‘'},
  {m:9,  name:'9ì›”(êµ­í™”)',  theme:'ì™„ì„±'},
  {m:10, name:'10ì›”(ë‹¨í’)', theme:'ì „í™˜'},
  {m:11, name:'11ì›”(ì˜¤ë™)', theme:'í™•ì¥'},
  {m:12, name:'12ì›”(ë¹„)',   theme:'ë§ˆë¬´ë¦¬'}
];

// ì¹´ë“œ ë“±ê¸‰ ë¶„ë¥˜ (ê²Œì„ ìŠ¤íƒ€ì¼)
const typeByIndex = (iInMonth) => {
  // 0..3
  // 0: ì „ì„¤ (ê¸°ì¡´ ê´‘), 1: ìœ ë‹ˆí¬ (ê¸°ì¡´ ë ), 2: ë ˆì–´ (ê¸°ì¡´ í”¼), 3: ë ˆì–´/íŠ¹ë³„ (ëœë¤)
  if(iInMonth === 0) return 'legendary';  // ê¸°ì¡´ gwang - ìµœê³  ë“±ê¸‰
  if(iInMonth === 1) return 'unique';     // ê¸°ì¡´ tti
  if(iInMonth === 2) return 'rare';       // ê¸°ì¡´ pi
  return Math.random() < 0.25 ? 'special' : 'rare';
};

const cards = Array.from({length:48}, (_,idx)=>{
  const monthIndex = Math.floor(idx/4); // 0..11
  const inMonth = idx % 4; // 0..3
  const t = typeByIndex(inMonth);
  const m = months[monthIndex];
  const id = idx+1;
  // íŒŒì¼ëª… í˜•ì‹: {ì›”}-{ì¹´ë“œë²ˆí˜¸}.png (ì˜ˆ: 1-1.png, 12-4.png)
  const month = monthIndex + 1;
  const cardInMonth = inMonth + 1;
  return {
    id,
    month: m.m,
    monthName: m.name,
    theme: m.theme,
    type: t,
    tags: [t, m.theme],
    img: `./assets/cards/${month}-${cardInMonth}.png`
  };
});

/* =========================
   2) ë°ì¼ë¦¬ ë“œë¡œìš°(í•˜ë£¨ 1íšŒ ê³ ì •)
   - ë‚ ì§œ + ë¸Œë¼ìš°ì € ì •ë³´ ê¸°ë°˜ seed
========================= */
function hashString(str){
  let h = 2166136261;
  for(let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}
function mulberry32(a){
  return function(){
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  }
}
function todayKey(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}

// ì‚¬ìš©ìë³„ ê³ ìœ  ID ìƒì„± (í•œ ë²ˆ ìƒì„±ë˜ë©´ ê³„ì† ìœ ì§€)
function getUserId(){
  const STORAGE_KEY = 'hwatu.userId';
  try {
    let userId = localStorage.getItem(STORAGE_KEY);
    if(!userId){
      // crypto.randomUUIDê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ëœë¤ ìƒì„±
      if(crypto.randomUUID){
        userId = crypto.randomUUID();
      } else {
        const bytes = new Uint8Array(16);
        crypto.getRandomValues(bytes);
        userId = Array.from(bytes, b => b.toString(16).padStart(2,'0')).join('');
      }
      localStorage.setItem(STORAGE_KEY, userId);
    }
    return userId;
  } catch(e){
    // localStorage ì‹¤íŒ¨ ì‹œ ì„ì‹œ ID ìƒì„±
    return 'temp-' + Math.random().toString(36).slice(2) + Date.now().toString(36);
  }
}

// í•˜ë£¨ ë½‘ê¸° íšŸìˆ˜ ê´€ë¦¬
function getDrawCount(){
  const key = todayKey();
  const saved = JSON.parse(localStorage.getItem('hwatu.drawCount') || 'null');
  if(saved && saved.key === key){
    return saved.count || 0;
  }
  return 0;
}

function incrementDrawCount(){
  const key = todayKey();
  const count = getDrawCount() + 1;
  localStorage.setItem('hwatu.drawCount', JSON.stringify({key, count}));
  return count;
}

function canDraw(){
  // ì œí•œ ì—†ìŒ - í•­ìƒ ë½‘ì„ ìˆ˜ ìˆìŒ
  return true;
}

function dailyPick(){
  // ë§¤ë²ˆ ëœë¤í•˜ê²Œ ë‹¤ë¥¸ ì¹´ë“œ ì„ íƒ (ì‚¬ìš©ìë§ˆë‹¤, ë½‘ì„ ë•Œë§ˆë‹¤ ë‹¤ë¦„)
  // íƒ€ì„ìŠ¤íƒ¬í”„ + ì‚¬ìš©ì ID + ëœë¤ ê°’ì„ ì¡°í•©í•´ì„œ ì™„ì „íˆ ëœë¤í•˜ê²Œ
  const userId = getUserId();
  const timestamp = Date.now();
  const random = Math.random().toString(36);
  const seed = hashString(userId + timestamp + random);
  const rng = mulberry32(seed);
  return cards[Math.floor(rng()*cards.length)];
}

/* =========================
   3) ìš´ì„¸ ë¬¸êµ¬ ìƒì„±(íƒœê·¸ ê¸°ë°˜)
========================= */
const fortuneBase = {
  legendary: [  // ê¸°ì¡´ unique (ê´‘) - ìµœê³  ë“±ê¸‰
    "ì˜¤ëŠ˜ì€ ì™„ë²½í•œ ë‚ ì´ì—ìš”! í•˜ê³  ì‹¶ì€ ì¼ì„ ëª¨ë‘ ì‹œì‘í•´ë³´ì„¸ìš”.",
    "í° ê¸°íšŒê°€ ì°¾ì•„ì˜¤ëŠ” íŠ¹ë³„í•œ ë‚ ì…ë‹ˆë‹¤. ìš©ê¸°ë¥¼ ë‚´ì„œ ë„ì „í•´ë³´ì„¸ìš”.",
    "ëª¨ë“  ê²ƒì´ ìˆœì¡°ë¡­ê²Œ í˜ëŸ¬ê°€ëŠ” ë‚ ì´ì—ìš”. ì¤‘ìš”í•œ ê²°ì •ë„ ì˜¤ëŠ˜ í•˜ë©´ ì¢‹ì•„ìš”."
  ],
  unique: [    // ê¸°ì¡´ rare (ë )
    "ì˜¤ëŠ˜ì€ ì¤‘ì‹¬ì„ ì¡ìœ¼ë©´ ì¢‹ì€ ê²°ê³¼ê°€ ë”°ë¼ì˜µë‹ˆë‹¤.",
    "ì£¼ë„ê¶Œì„ ì¡ëŠ” ìª½ì´ ìœ ë¦¬í•œ ë‚ ì´ì—ìš”. ì ê·¹ì ìœ¼ë¡œ ë‚˜ì„œë³´ì„¸ìš”.",
    "í˜‘ë ¥ê³¼ ì†Œí†µì—ì„œ ì¢‹ì€ ê¸°íšŒê°€ ì°¾ì•„ì˜µë‹ˆë‹¤."
  ],
  rare: [      // ê¸°ì¡´ common (í”¼)
    "ì˜¤ëŠ˜ì€ ì°¨ê·¼ì°¨ê·¼ ì§„í–‰í•˜ë©´ ì¢‹ì€ ê²°ê³¼ê°€ ë‚˜ì˜¬ ê±°ì˜ˆìš”.",
    "ì‘ì€ ë…¸ë ¥ì´ í° ì„±ê³¼ë¡œ ì´ì–´ì§€ëŠ” ë‚ ì…ë‹ˆë‹¤.",
    "ì•ˆì •ì ì¸ íë¦„ ì†ì—ì„œ ê¸°íšŒë¥¼ ë°œê²¬í•  ìˆ˜ ìˆì–´ìš”."
  ],
  special: [
    "ì˜ˆìƒ ë°–ì˜ ì¢‹ì€ ê¸°íšŒê°€ ë“¤ì–´ì˜¬ ìˆ˜ ìˆì–´ìš”. ëˆˆì„ í¬ê²Œ ëœ¨ê³  ê¸°ë‹¤ë ¤ë³´ì„¸ìš”.",
    "í•œ ë²ˆì˜ ì„ íƒì´ ëª¨ë“  ê²ƒì„ ë°”ê¿€ ìˆ˜ ìˆëŠ” íŠ¹ë³„í•œ ë‚ ì…ë‹ˆë‹¤.",
    "ìƒˆë¡œìš´ ê¸°íšŒê°€ ì°¾ì•„ì˜¤ëŠ” ë‚ ì´ì—ìš”. ì¤€ë¹„ëœ ìì—ê²Œ í–‰ìš´ì´ ë”°ë¦…ë‹ˆë‹¤."
  ]
};

const themeHint = {
  ì‹œì‘: "ìƒˆë¡œ ì‹œì‘í•˜ê¸° ì¢‹ì€ íƒ€ì´ë°.",
  ê´€ê³„: "ì‚¬ëŒì—ì„œ ìš´ì´ íŠ¸ì´ëŠ” íë¦„.",
  ê¸°íšŒ: "ì‘ì€ ê¸°íšŒë¥¼ í¬ê²Œ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.",
  ì •ë¦¬: "ë¹„ìš°ë©´ ë‹¤ìŒì´ ë“¤ì–´ì˜µë‹ˆë‹¤.",
  ìŠ¹ë¶€: "ë°€ì–´ë¶™ì¼ ê±´ ë°€ì–´ë¶™ì´ê¸°.",
  í’ìš”: "ì—¬ìœ ê°€ ìƒê¸°ë©´ ë‚˜ëˆ”ë„ ì¢‹ì•„ìš”.",
  íšŒë³µ: "ì»¨ë””ì…˜ íšŒë³µì´ ìµœìš°ì„ .",
  ì§‘ì¤‘: "í•œ ê°€ì§€ì— ëª°ì…í•˜ë©´ ì„±ê³¼ê°€ ë‚©ë‹ˆë‹¤.",
  ì™„ì„±: "ë§ˆë¬´ë¦¬í•˜ë©´ í‰ê°€ê°€ ì¢‹ì•„ì ¸ìš”.",
  ì „í™˜: "ë£¨í‹´ì„ ë°”ê¾¸ë©´ ê¸°íšŒê°€ ì—´ë¦½ë‹ˆë‹¤.",
  í™•ì¥: "ìŠ¤ì¼€ì¼ì„ í‚¤ìš°ê¸° ì¢‹ì€ ë‚ .",
  ë§ˆë¬´ë¦¬: "ë§ˆì§€ë§‰ ì ê²€ì´ ì‹¤ìˆ˜ë¥¼ ë§‰ì•„ìš”."
};

function pickOne(arr, rng){
  return arr[Math.floor(rng()*arr.length)];
}

function makeFortune(card, isPractice=false){
  // ë§¤ë²ˆ ëœë¤í•˜ê²Œ ìš´ì„¸ ìƒì„± (ì¹´ë“œ ID + íƒ€ì„ìŠ¤íƒ¬í”„ + ëœë¤)
  const randomSeed = String(Math.random()) + Date.now() + card.id;
  const seed = hashString(randomSeed);
  const rng = mulberry32(seed);

  const line1 = pickOne(fortuneBase[card.type] || fortuneBase.rare, rng);
  const line2 = themeHint[card.theme] || "ì˜¤ëŠ˜ íë¦„ì„ ê°€ë³ê²Œ ì½ì–´ë³´ì„¸ìš”.";

  // ì ìˆ˜ ê°ê°(ì¬ë¯¸ìš©) - ë‹¤ì–‘í•œ ë¶„í¬ë¡œ ì¡°ì • (60ì ëŒ€ë¶€í„° 100ì ê¹Œì§€)
  const scoreBase = {legendary: 85, unique: 78, special: 75, rare: 72};
  // ê¸°ë³¸ ì ìˆ˜ì— -5ë¶€í„° +15ê¹Œì§€ ëœë¤ ë³€ë™ (60ì ëŒ€~100ì  ê°€ëŠ¥)
  const variance = Math.floor(rng() * 21) - 5; // -5 ~ +15
  const score = Math.max(60, Math.min(100, (scoreBase[card.type]||70) + variance));

  // í–‰ë™ ì¶”ì²œ(ì§§ê²Œ)
  const actions = [
    "ê²°ì •í•´ì•¼ í•  ê±´ 1ê°œë§Œ ë¨¼ì €.",
    "ì˜¤ëŠ˜ì€ â€˜ë¹¨ë¦¬â€™ë³´ë‹¤ â€˜ì •í™•íˆâ€™.",
    "ëŒ€í™” í•˜ë‚˜ë§Œ ë” í•´ë³´ê¸°.",
    "30ë¶„ë§Œ ëª°ì…í•˜ê³  ëŠê¸°.",
    "ë¯¸ë£¨ë˜ ê²ƒ 1ê°œ ì •ë¦¬í•˜ê¸°."
  ];
  const action = pickOne(actions, rng);

  return { line1, line2, score, action };
}

/* =========================
   4) ê¸°ë¡(ìµœê·¼ 7ì¼)
========================= */
function loadHistory(){
  return JSON.parse(localStorage.getItem('hwatu.history')||'[]');
}
function saveHistory(list){
  localStorage.setItem('hwatu.history', JSON.stringify(list.slice(-7)));
}
function renderHistory(){
  const wrap = document.getElementById('history');
  const list = loadHistory().slice().reverse();
  wrap.innerHTML = '';
  if(list.length === 0){
    wrap.innerHTML = `<div class="hint">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”. ì˜¤ëŠ˜ í•œ ì¥ ë½‘ì•„ë³´ì„¸ìš”.</div>`;
    return;
  }
  list.forEach(item=>{
    const div = document.createElement('div');
    div.className = 'h-item';
    div.innerHTML = `
      <div class="left">
        <div class="date">${item.key}</div>
        <div class="name">${item.name}</div>
      </div>
      <div class="tag">${item.type.toUpperCase()} Â· ${item.theme}</div>
    `;
    wrap.appendChild(div);
  });
}

/* =========================
   5) UI ë°”ì¸ë”©
========================= */
const flip = document.getElementById('flip');
const cardImg = document.getElementById('cardImg');
const fallback = document.getElementById('fallback');
const imgPath = document.getElementById('imgPath');
const badges = document.getElementById('badges');
const resultTitle = document.getElementById('resultTitle');
const resultText = document.getElementById('resultText');
const drawBtn = document.getElementById('drawBtn');
const copyBtn = document.getElementById('copyBtn');
const shareImageBtn = document.getElementById('shareImageBtn');

let current = null;
let currentFortune = null;

function setBadges(card){
  const typeLabel = ({legendary:'ì „ì„¤', unique:'ìœ ë‹ˆí¬', rare:'ë ˆì–´', special:'íŠ¹ë³„'})[card.type] || 'ë ˆì–´';
  badges.innerHTML = `
    <span class="badge">ğŸ“… ${card.monthName}</span>
    <span class="badge">ğŸ·ï¸ ${typeLabel}</span>
    <span class="badge">ğŸ§­ ${card.theme}</span>
  `;
  badges.style.display = 'flex'; // ë°°ì§€ í‘œì‹œ
}

function showCard(card){
  current = card;
  // ë°°ì§€ëŠ” ê²°ê³¼ê°€ ë‚˜ì˜¬ ë•Œë§Œ í‘œì‹œ (updateResultì—ì„œ ì²˜ë¦¬)

  // ì´ë¯¸ì§€ ë¡œë“œ
  cardImg.src = card.img;
  imgPath.textContent = card.img;

  cardImg.onload = () => {
    fallback.style.display = 'none';
    cardImg.style.display = 'block';
  };
  cardImg.onerror = () => {
    cardImg.style.display = 'none';
    fallback.style.display = 'block';
  };
}

function updateResult(card, fortune, isPractice){
  const mode = isPractice ? "ì—°ìŠµ ê²°ê³¼" : "ì˜¤ëŠ˜ì˜ ê²°ê³¼";
  resultTitle.textContent = `${mode} Â· ìš´ì„¸ ì ìˆ˜ ${fortune.score}ì `;
  resultText.innerHTML = `
    ${fortune.line1}<br/>
    <small>${fortune.line2}</small><br/>
    <small>ì˜¤ëŠ˜ì˜ ì œì•ˆ: <b>${fortune.action}</b></small>
  `;
  // ë°°ì§€ í‘œì‹œ (ê²°ê³¼ê°€ ë‚˜ì˜¬ ë•Œë§Œ)
  setBadges(card);
  
  // ë³µì‚¬/ê³µìœ  ë²„íŠ¼ì€ í•­ìƒ í™œì„±í™” (ë½‘ê¸° íšŸìˆ˜ì™€ ë¬´ê´€)
  copyBtn.disabled = false;
  shareImageBtn.disabled = false;
}

function updateDrawCount(){
  // ë½‘ê¸° ë²„íŠ¼ì€ í•­ìƒ í™œì„±í™” (ì œí•œ ì—†ìŒ)
  drawBtn.disabled = false;
  drawBtn.textContent = 'ì˜¤ëŠ˜ ìš´ì„¸ ë½‘ê¸°';
  
  // ë³µì‚¬/ê³µìœ  ë²„íŠ¼ì€ í•­ìƒ í™œì„±í™” (ê²°ê³¼ê°€ ìˆìœ¼ë©´)
  if(current && currentFortune){
    copyBtn.disabled = false;
    shareImageBtn.disabled = false;
  }
}

function showAd(){
  // ê´‘ê³  ìŠ¬ë¡¯ì´ ìˆìœ¼ë©´ ë‹¤ì‹œ ë¡œë“œ
  const adSlot = document.querySelector('.adsbygoogle');
  if(adSlot && window.adsbygoogle){
    try {
      (window.adsbygoogle = window.adsbygoogle || []).push({});
    } catch(e){
      console.log('Ad reload:', e);
    }
  }
}

function doDailyDraw(){
  const card = dailyPick();
  showCard(card);
  const f = makeFortune(card, false);
  currentFortune = f;

  // flip
  flip.classList.add('is-flipped');
  updateResult(card, f, false);

  // ë½‘ê¸° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
  updateDrawCount();

  // ê´‘ê³  í‘œì‹œ
  setTimeout(() => {
    showAd();
  }, 500);

  // ê¸°ë¡ ì €ì¥ (ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì €ì¥, ê°™ì€ ì¹´ë“œ ì¤‘ë³µ ì €ì¥ ë°©ì§€)
  const key = todayKey();
  const hist = loadHistory();
  // ê°™ì€ ë‚ ì§œì— ê°™ì€ ì¹´ë“œëŠ” ì¤‘ë³µ ì €ì¥í•˜ì§€ ì•ŠìŒ (ê°™ì€ ì¹´ë“œ ì—¬ëŸ¬ ë²ˆ ë½‘ì€ ê²½ìš°)
  const todaySame = hist.filter(x => x.key === key && x.id === card.id);
  if(todaySame.length === 0){
    hist.push({key, name: card.monthName, type: card.type, theme: card.theme, id: card.id});
    saveHistory(hist);
    renderHistory();
  }
}


function copyResult(){
  if(!current || !currentFortune) return;
  const typeLabel = ({legendary:'ì „ì„¤', unique:'ìœ ë‹ˆí¬', rare:'ë ˆì–´', special:'íŠ¹ë³„'})[current.type] || 'ë ˆì–´';
  const text =
`ğŸ´ í™”íˆ¬ ìš´ì„¸: ${current.monthName} (${typeLabel}/${current.theme})
ì ìˆ˜: ${currentFortune.score}ì 
í•œì¤„: ${currentFortune.line1}
ì œì•ˆ: ${currentFortune.action}

https://hwatu.funnyfunny.cloud
#í™”íˆ¬ìš´ì„¸ #funnyfunny #HwatuFortune`;

  navigator.clipboard.writeText(text)
    .then(()=> alert('ê²°ê³¼ê°€ ë³µì‚¬ëì–´ìš”! Xì— ë¶™ì—¬ë„£ê¸° í•˜ë©´ ë©ë‹ˆë‹¤.'))
    .catch(()=> alert('ë³µì‚¬ ì‹¤íŒ¨â€¦ ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ ì£¼ì„¸ìš”.'));
}

async function shareImage(){
  if(!current || !currentFortune) return;
  
  try {
    // Canvas ìƒì„±
    const canvas = document.createElement('canvas');
    canvas.width = 1200;
    canvas.height = 900;
    const ctx = canvas.getContext('2d');
    
    // ë°°ê²½ ê·¸ë¼ë°ì´ì…˜
    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    gradient.addColorStop(0, '#0b1220');
    gradient.addColorStop(0.5, '#111827');
    gradient.addColorStop(1, '#0b1220');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // í™”íˆ¬ ì¹´ë“œ ì´ë¯¸ì§€ ë¡œë“œ ë° ê·¸ë¦¬ê¸°
    const cardImgLoaded = await new Promise((resolve) => {
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = () => resolve(img);
      img.onerror = () => resolve(null);
      img.src = current.img;
    });
    
    // ì¹´ë“œ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸° (ì™¼ìª½ ìƒë‹¨)
    if(cardImgLoaded){
      const cardSize = 200;
      const cardX = 100;
      const cardY = 100;
      const cardHeight = cardSize * 1.38;
      const radius = 8;
      
      // ì¹´ë“œ ë°°ê²½ (í°ìƒ‰ ë‘¥ê·¼ ëª¨ì„œë¦¬ íš¨ê³¼)
      ctx.fillStyle = '#ffffff';
      ctx.beginPath();
      const bgX = cardX - 8;
      const bgY = cardY - 8;
      const bgW = cardSize + 16;
      const bgH = cardHeight + 16;
      // ë‘¥ê·¼ ì‚¬ê°í˜• ê·¸ë¦¬ê¸°
      ctx.moveTo(bgX + radius, bgY);
      ctx.lineTo(bgX + bgW - radius, bgY);
      ctx.quadraticCurveTo(bgX + bgW, bgY, bgX + bgW, bgY + radius);
      ctx.lineTo(bgX + bgW, bgY + bgH - radius);
      ctx.quadraticCurveTo(bgX + bgW, bgY + bgH, bgX + bgW - radius, bgY + bgH);
      ctx.lineTo(bgX + radius, bgY + bgH);
      ctx.quadraticCurveTo(bgX, bgY + bgH, bgX, bgY + bgH - radius);
      ctx.lineTo(bgX, bgY + radius);
      ctx.quadraticCurveTo(bgX, bgY, bgX + radius, bgY);
      ctx.closePath();
      ctx.fill();
      
      // ì¹´ë“œ ì´ë¯¸ì§€ (ë‘¥ê·¼ ëª¨ì„œë¦¬)
      ctx.save();
      ctx.beginPath();
      ctx.moveTo(cardX + radius, cardY);
      ctx.lineTo(cardX + cardSize - radius, cardY);
      ctx.quadraticCurveTo(cardX + cardSize, cardY, cardX + cardSize, cardY + radius);
      ctx.lineTo(cardX + cardSize, cardY + cardHeight - radius);
      ctx.quadraticCurveTo(cardX + cardSize, cardY + cardHeight, cardX + cardSize - radius, cardY + cardHeight);
      ctx.lineTo(cardX + radius, cardY + cardHeight);
      ctx.quadraticCurveTo(cardX, cardY + cardHeight, cardX, cardY + cardHeight - radius);
      ctx.lineTo(cardX, cardY + radius);
      ctx.quadraticCurveTo(cardX, cardY, cardX + radius, cardY);
      ctx.closePath();
      ctx.clip();
      ctx.drawImage(cardImgLoaded, cardX, cardY, cardSize, cardHeight);
      ctx.restore();
    }
    
    // ì œëª© (ì¹´ë“œê°€ ìˆìœ¼ë©´ ì˜¤ë¥¸ìª½ìœ¼ë¡œ, ì—†ìœ¼ë©´ ì¤‘ì•™)
    ctx.fillStyle = '#ffffff';
    ctx.textAlign = cardImgLoaded ? 'left' : 'center';
    ctx.font = 'bold 64px system-ui, -apple-system, "Noto Sans KR", sans-serif';
    const titleX = cardImgLoaded ? 340 : canvas.width / 2;
    ctx.fillText('ğŸ´ í™”íˆ¬ ìš´ì„¸', titleX, 140);
    
    // ì¹´ë“œ ì •ë³´
    const typeLabel = ({legendary:'ì „ì„¤', unique:'ìœ ë‹ˆí¬', rare:'ë ˆì–´', special:'íŠ¹ë³„'})[current.type] || 'ë ˆì–´';
    ctx.font = '36px system-ui, -apple-system, "Noto Sans KR", sans-serif';
    ctx.fillText(`${current.monthName} Â· ${typeLabel} Â· ${current.theme}`, titleX, 200);
    
    // ì ìˆ˜
    ctx.fillStyle = '#fbbf24';
    ctx.font = 'bold 48px system-ui, -apple-system, "Noto Sans KR", sans-serif';
    ctx.fillText(`ìš´ì„¸ ì ìˆ˜ ${currentFortune.score}ì `, titleX, 270);
    
    // ìš´ì„¸ ë‚´ìš© (ì¹´ë“œ ì•„ë˜ìª½ ì¤‘ì•™)
    ctx.fillStyle = '#ffffff';
    ctx.textAlign = 'center';
    ctx.font = '42px system-ui, -apple-system, "Noto Sans KR", sans-serif';
    
    // í•œì¤„ ìš´ì„¸
    const line1Y = cardImgLoaded ? 420 : 400;
    ctx.fillText(currentFortune.line1, canvas.width / 2, line1Y);
    
    // í…Œë§ˆ íŒíŠ¸
    ctx.fillStyle = '#d1d5db';
    ctx.font = '32px system-ui, -apple-system, "Noto Sans KR", sans-serif';
    const line2Y = line1Y + 60;
    ctx.fillText(currentFortune.line2 || '', canvas.width / 2, line2Y);
    
    // ì˜¤ëŠ˜ì˜ ì œì•ˆ
    ctx.fillStyle = '#ffffff';
    ctx.font = '36px system-ui, -apple-system, "Noto Sans KR", sans-serif';
    const actionY = line2Y + 100;
    ctx.fillText(`ì˜¤ëŠ˜ì˜ ì œì•ˆ: ${currentFortune.action}`, canvas.width / 2, actionY);
    
    // ë„ë©”ì¸
    ctx.fillStyle = '#9ca3af';
    ctx.font = '28px system-ui, -apple-system, "Noto Sans KR", sans-serif';
    ctx.fillText('hwatu.funnyfunny.cloud', canvas.width / 2, canvas.height - 60);
    
    // Canvasë¥¼ Blobìœ¼ë¡œ ë³€í™˜
    canvas.toBlob(async (blob) => {
      if(!blob) {
        alert('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨');
        return;
      }
      
      // Web Share API ì§€ì› í™•ì¸
      if(navigator.share && navigator.canShare && navigator.canShare({files: [new File([blob], 'hwatu-fortune.png', {type: 'image/png'})]})){
        try {
          const file = new File([blob], 'hwatu-fortune.png', {type: 'image/png'});
          await navigator.share({
            files: [file],
            title: 'í™”íˆ¬ ìš´ì„¸',
            text: `í™”íˆ¬ ìš´ì„¸: ${current.monthName} - ${currentFortune.score}ì `
          });
          alert('ê³µìœ  ì™„ë£Œ!');
          return;
        } catch(err){
          if(err.name !== 'AbortError'){
            console.error('Share failed:', err);
          } else {
            return; // ì‚¬ìš©ìê°€ ì·¨ì†Œí•œ ê²½ìš°
          }
        }
      }
      
      // Web Share API ë¯¸ì§€ì› ì‹œ ë‹¤ìš´ë¡œë“œ
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `hwatu-fortune-${todayKey()}.png`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œëì–´ìš”! SNSì— ì—…ë¡œë“œí•´ì„œ ê³µìœ í•˜ì„¸ìš”.');
    }, 'image/png');
    
  } catch(err){
    console.error('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨:', err);
    alert('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  }
}

// ì´ˆê¸° ë Œë”
renderHistory();
updateDrawCount();
showCard(dailyPick()); // ì¹´ë“œë§Œ ë¯¸ë¦¬ ì„¸íŒ…(ë’¤ì§‘ê¸° ì „)

// ì´ë²¤íŠ¸
drawBtn.addEventListener('click', doDailyDraw);
copyBtn.addEventListener('click', copyResult);
shareImageBtn.addEventListener('click', shareImage);

// ì¹´ë“œ í´ë¦­í•˜ë©´ ìƒˆë¡œìš´ ìš´ì„¸ ë½‘ê¸°
flip.addEventListener('click', ()=>{
  doDailyDraw();
});
</script>
</body>
</html>
