<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í™”íˆ¬ ìš´ì„¸ | ì˜¤ëŠ˜ì˜ í•œ ì¥ ìš´ì„¸</title>

  <!-- OG -->
  <meta property="og:title" content="Hwatu Fortune" />
  <meta property="og:description" content="í™”íˆ¬ í•œ ì¥ìœ¼ë¡œ ì˜¤ëŠ˜ ìš´ì„¸ ë½‘ê¸°" />
  <meta property="og:image" content="https://dummyimage.com/1200x630/0b1220/ffffff&text=Hwatu+Fortune" />

  <!-- Favicon (SVG) -->
  <link rel="icon" href="data:image/svg+xml,
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
    <rect width='100' height='100' rx='20' fill='%230b1220'/>
    <text x='50' y='62' font-size='52' text-anchor='middle' fill='white'>ğŸƒ</text>
  </svg>">

  <style>
    :root{
      --bg:#0b1220;
      --card:#111827;
      --paper:#ffffff;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#111;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background:#f6f7fb;
      color:#111;
    }
    header{
      background:var(--bg);
      color:#fff;
      padding:22px 16px;
      text-align:center;
    }
    header h1{ margin:0 0 6px; font-size:22px; letter-spacing:-0.2px; }
    header p{ margin:0; opacity:0.9; font-size:14px; }

    main{ max-width:960px; margin:0 auto; padding:18px 16px 28px; }

    .row{ display:grid; grid-template-columns: 1fr; gap:14px; }
    @media (min-width:860px){
      .row{ grid-template-columns: 1.1fr 0.9fr; align-items:start; }
    }

    .panel{
      background:var(--paper);
      border:1px solid var(--line);
      border-radius:14px;
      padding:16px;
      box-shadow: 0 6px 18px rgba(17,24,39,0.06);
    }

    .hint{
      font-size:13px;
      color:var(--muted);
      line-height:1.5;
      margin:8px 0 0;
    }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    button{
      border:none;
      border-radius:12px;
      padding:12px 14px;
      font-weight:700;
      cursor:pointer;
      background:var(--bg);
      color:#fff;
      letter-spacing:-0.2px;
    }
    button.secondary{
      background:#eef2ff;
      color:#111;
    }
    button.ghost{
      background:#fff;
      color:#111;
      border:1px solid var(--line);
    }
    button:disabled{
      opacity:0.55;
      cursor:not-allowed;
    }

    /* Card flip */
    .stage{ display:flex; justify-content:center; padding:8px 0 6px; }
    .flip{
      width:260px;
      height:360px;
      perspective: 1200px;
    }
    .flip-inner{
      width:100%;
      height:100%;
      position:relative;
      transform-style:preserve-3d;
      transition: transform .75s cubic-bezier(.2,.8,.2,1);
      border-radius:16px;
    }
    .flip.is-flipped .flip-inner{ transform: rotateY(180deg); }
    .face{
      position:absolute;
      inset:0;
      border-radius:16px;
      overflow:hidden;
      backface-visibility:hidden;
      border:1px solid rgba(229,231,235,0.9);
      box-shadow: 0 16px 30px rgba(0,0,0,0.12);
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .back{
      background: linear-gradient(135deg, #0b1220 0%, #111827 55%, #0b1220 100%);
      color:#fff;
      flex-direction:column;
      gap:10px;
    }
    .back .mark{
      width:86px;height:86px;border-radius:22px;
      border:1px solid rgba(255,255,255,0.18);
      display:flex;align-items:center;justify-content:center;
      font-size:44px;
      background: rgba(255,255,255,0.06);
    }
    .back .txt{ font-weight:800; letter-spacing:-0.2px; }
    .front{
      transform: rotateY(180deg);
      background:#fff;
    }
    .front img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .front .fallback{
      padding:18px;
      text-align:center;
      color:#111;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      font-size:13px;
      color:#111;
      background:#fff;
    }
    .badges{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:8px; }

    .result-title{ margin:8px 0 0; text-align:center; font-size:18px; }
    .result-sub{ margin:8px auto 0; text-align:center; max-width:42ch; color:#111; line-height:1.55; }
    .result-sub small{ color:var(--muted); }

    .kv{
      display:grid;
      grid-template-columns: 88px 1fr;
      gap:8px 10px;
      margin-top:14px;
      font-size:14px;
      color:#111;
    }
    .kv .k{ color:var(--muted); }

    .history{
      margin-top:8px;
      display:grid;
      gap:10px;
    }
    .h-item{
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
      background:#fff;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
    }
    .h-item .left{ display:flex; flex-direction:column; gap:2px; }
    .h-item .date{ font-size:12px; color:var(--muted); }
    .h-item .name{ font-weight:800; letter-spacing:-0.2px; }
    .h-item .tag{ font-size:12px; color:#111; border:1px solid var(--line); padding:6px 8px; border-radius:999px; background:#fff; white-space:nowrap; }

    footer{
      text-align:center;
      padding:16px 12px 24px;
      color:var(--muted);
      font-size:13px;
    }
    footer a{ color:#111; font-weight:800; text-decoration:none; }
  </style>
</head>

<body>
<header>
  <h1>í™”íˆ¬ ìš´ì„¸</h1>
  <p>ì˜¤ëŠ˜ì˜ í•œ ì¥ â€” ê°„í¸í•˜ê²Œ ë. ê²°ê³¼ëŠ” ë³µì‚¬í•´ì„œ Xì— ë¶™ì—¬ë„£ê¸°.</p>
</header>

<main>
  <div class="row">
    <!-- Left: Card -->
    <section class="panel">
      <div class="stage">
        <div class="flip" id="flip">
          <div class="flip-inner">
            <div class="face back">
              <div class="mark">ğŸ´</div>
              <div class="txt">ì˜¤ëŠ˜ì˜ í™”íˆ¬ 1ì¥</div>
              <div style="font-size:13px;opacity:.85;">í´ë¦­í•´ì„œ ë’¤ì§‘ê¸°</div>
            </div>
            <div class="face front">
              <img id="cardImg" alt="í™”íˆ¬ ì¹´ë“œ" />
              <div class="fallback" id="fallback" style="display:none;">
                <div style="font-size:18px;font-weight:900;">ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨</div>
                <div style="margin-top:8px;color:var(--muted);line-height:1.45;">
                  <div>ê²½ë¡œ: <code id="imgPath"></code></div>
                  <div style="margin-top:6px;">assets/cards/1-1.png ~ 12-4.png í˜•ì‹ìœ¼ë¡œ ë§ì¶°ì£¼ì„¸ìš”</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="badges" id="badges"></div>

      <div class="result-title" id="resultTitle">ì•„ì§ êµ¬ì¡° ì „</div>
      <div class="result-sub" id="resultText">ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ ì¹´ë“œë¥¼ ë’¤ì§‘ìœ¼ë©´ ì˜¤ëŠ˜ ìš´ì„¸ê°€ ë‚˜ì˜µë‹ˆë‹¤.</div>

      <div class="actions">
        <button id="drawBtn">ì˜¤ëŠ˜ ìš´ì„¸ ë½‘ê¸°</button>
        <button class="secondary" id="copyBtn" disabled>ê²°ê³¼ ë³µì‚¬</button>
        <button class="ghost" id="rerollBtn">ë‹¤ì‹œ ë½‘ê¸°(ì—°ìŠµ)</button>
      </div>

      <p class="hint">
        â€¢ <b>ì˜¤ëŠ˜ ìš´ì„¸</b>ëŠ” í•˜ë£¨ 1íšŒ ê³ ì •(ìƒˆë¡œê³ ì¹¨í•´ë„ ë™ì¼)ì…ë‹ˆë‹¤.<br/>
        â€¢ <b>ë‹¤ì‹œ ë½‘ê¸°(ì—°ìŠµ)</b>ëŠ” ê³µìœ ìš©Â·í…ŒìŠ¤íŠ¸ìš©ì´ë©°, ì˜¤ëŠ˜ ìš´ì„¸ ê¸°ë¡ì—ëŠ” ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </p>
    </section>

    <!-- Right: Info / History -->
    <aside class="panel">
      <div class="badge">ğŸ“Œ ì—”ì§„ ì„¤ëª…</div>
      <p class="hint" style="margin-top:10px;">
        ì´ ì„œë¹„ìŠ¤ëŠ” â€˜ë°©ì†¡â€™ì´ ì•„ë‹ˆë¼ <b>í”„ë¡œê·¸ë¨</b>ì…ë‹ˆë‹¤.<br/>
        ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë™ì¼í•œ ì¹´ë“œê°€ ì„ íƒë˜ë©°,
        ì¹´ë“œ íƒœê·¸(ê´‘/ë /í”¼/ì›”/ìƒì§•)ë¥¼ ì´ìš©í•´ ìš´ì„¸ ë¬¸êµ¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
      </p>

      <div class="kv">
        <div class="k">ë„ë©”ì¸</div><div><b>fridge.funnyfunny.cloud</b> íŒ¨ë°€ë¦¬ ë£©ìœ¼ë¡œ ìš´ì˜ ì¶”ì²œ</div>
        <div class="k">ê³µìœ </div><div>ë³µì‚¬ ë²„íŠ¼ìœ¼ë¡œ X/ì¹´í†¡/ë©”ëª¨ì¥ ë°”ë¡œ ë¶™ì—¬ë„£ê¸°</div>
        <div class="k">ì¬ë°©ë¬¸</div><div>ìµœê·¼ 7ì¼ ê¸°ë¡ì„ ë‚¨ê²¨ â€œë§¤ì¼ í•œ ë²ˆâ€ ìŠµê´€í™”</div>
      </div>

      <hr style="border:none;border-top:1px solid var(--line); margin:14px 0;" />

      <div class="badge">ğŸ•˜ ìµœê·¼ 7ì¼ ê¸°ë¡</div>
      <div class="history" id="history"></div>

      <div class="actions" style="margin-top:12px;">
        <a href="https://funnyfunny.cloud" target="_blank" rel="noopener">
          <button class="secondary" type="button">ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ë³´ê¸°</button>
        </a>
      </div>
    </aside>
  </div>
</main>

<footer>
  <div>Â© funnyfunny.cloud Â· <a href="https://funnyfunny.cloud" target="_blank" rel="noopener">funnyfunny.cloud</a></div>
</footer>

<script>
/* =========================
   1) í™”íˆ¬ ì¹´ë“œ ë°ì´í„°
   - ì´ë¯¸ì§€ íŒŒì¼ëª…: ./assets/hwatu/01.png ~ 48.png
   - ì´ë¯¸ ë„¤ê°€ ê°€ì§„ ì´ë¯¸ì§€ê°€ ìˆë‹¤ í–ˆìœ¼ë‹ˆ, íŒŒì¼ëª…ë§Œ ë§ì¶”ë©´ ë°”ë¡œ ëœ¸
========================= */
function pad2(n){ return String(n).padStart(2,'0'); }

// 12ê°œì›” x 4ì¥ = 48ì¥ (ë‹¨ìˆœ ì¸ë±ìŠ¤)
// ì‹¤ì œ ì„¸ë¶€ ì¹´ë“œ(ê´‘/ë /í”¼/íŠ¹ìˆ˜)ëŠ” tagsë¡œë§Œ êµ¬ë¶„í•´ë„ ì¶©ë¶„íˆ ì¬ë¯¸ê°€ ë‚¨
const months = [
  {m:1,  name:'1ì›”(ì†¡í•™)',  theme:'ì‹œì‘'},
  {m:2,  name:'2ì›”(ë§¤í™”)',  theme:'ê´€ê³„'},
  {m:3,  name:'3ì›”(ë²šê½ƒ)',  theme:'ê¸°íšŒ'},
  {m:4,  name:'4ì›”(ë“±ë‚˜ë¬´)',theme:'ì •ë¦¬'},
  {m:5,  name:'5ì›”(ì°½í¬)',  theme:'ìŠ¹ë¶€'},
  {m:6,  name:'6ì›”(ëª¨ë€)',  theme:'í’ìš”'},
  {m:7,  name:'7ì›”(ì‹¸ë¦¬)',  theme:'íšŒë³µ'},
  {m:8,  name:'8ì›”(ê³µì‚°)',  theme:'ì§‘ì¤‘'},
  {m:9,  name:'9ì›”(êµ­í™”)',  theme:'ì™„ì„±'},
  {m:10, name:'10ì›”(ë‹¨í’)', theme:'ì „í™˜'},
  {m:11, name:'11ì›”(ì˜¤ë™)', theme:'í™•ì¥'},
  {m:12, name:'12ì›”(ë¹„)',   theme:'ë§ˆë¬´ë¦¬'}
];

// ê°„ë‹¨ íƒœê·¸ êµ¬ì„±(ë„ˆê°€ ì›í•˜ë©´ ë‚˜ì¤‘ì— â€œì‹¤ì œ í™”íˆ¬ íƒœê·¸â€ë¡œ ë” ì •êµí™” ê°€ëŠ¥)
const typeByIndex = (iInMonth) => {
  // 0..3
  // 0: ê´‘ ê°€ëŠ¥ì„±, 1: ë , 2: í”¼, 3: í”¼/íŠ¹ìˆ˜ (ëœë¤)
  if(iInMonth === 0) return 'gwang';
  if(iInMonth === 1) return 'tti';
  if(iInMonth === 2) return 'pi';
  return Math.random() < 0.25 ? 'special' : 'pi';
};

const cards = Array.from({length:48}, (_,idx)=>{
  const monthIndex = Math.floor(idx/4); // 0..11
  const inMonth = idx % 4; // 0..3
  const t = typeByIndex(inMonth);
  const m = months[monthIndex];
  const id = idx+1;
  // íŒŒì¼ëª… í˜•ì‹: {ì›”}-{ì¹´ë“œë²ˆí˜¸}.png (ì˜ˆ: 1-1.png, 12-4.png)
  const month = monthIndex + 1;
  const cardInMonth = inMonth + 1;
  return {
    id,
    month: m.m,
    monthName: m.name,
    theme: m.theme,
    type: t,
    tags: [t, m.theme],
    img: `./assets/cards/${month}-${cardInMonth}.png`
  };
});

/* =========================
   2) ë°ì¼ë¦¬ ë“œë¡œìš°(í•˜ë£¨ 1íšŒ ê³ ì •)
   - ë‚ ì§œ + ë¸Œë¼ìš°ì € ì •ë³´ ê¸°ë°˜ seed
========================= */
function hashString(str){
  let h = 2166136261;
  for(let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}
function mulberry32(a){
  return function(){
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  }
}
function todayKey(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}
function dailyPick(){
  const key = todayKey();
  const saved = JSON.parse(localStorage.getItem('hwatu.daily')||'null');
  if(saved && saved.key === key && saved.cardId){
    return cards.find(c=>c.id===saved.cardId) || cards[0];
  }
  const seed = hashString(key + navigator.userAgent);
  const rng = mulberry32(seed);
  const card = cards[Math.floor(rng()*cards.length)];
  localStorage.setItem('hwatu.daily', JSON.stringify({key, cardId: card.id}));
  return card;
}

/* =========================
   3) ìš´ì„¸ ë¬¸êµ¬ ìƒì„±(íƒœê·¸ ê¸°ë°˜)
========================= */
const fortuneBase = {
  gwang: [
    "ì˜¤ëŠ˜ì€ ì¤‘ì‹¬ì„ ì¡ìœ¼ë©´ ê²°ê³¼ê°€ ë”°ë¼ì˜µë‹ˆë‹¤.",
    "ì£¼ë„ê¶Œì„ ì¡ëŠ” ìª½ì´ ìœ ë¦¬í•œ ë‚ ì´ì—ìš”.",
    "ê²°ì •ì„ ë¯¸ë£¨ì§€ ë§ê³  í•œ ë²ˆì— ì •ë¦¬í•´ë³´ì„¸ìš”."
  ],
  tti: [
    "í˜‘ì—…Â·ëŒ€í™”ì—ì„œ íŒíŠ¸ê°€ ë‚˜ì˜µë‹ˆë‹¤.",
    "ì‘ì€ ì•½ì†ì´ í° íë¦„ì„ ë§Œë“­ë‹ˆë‹¤.",
    "ì •ë¦¬í•  ê±´ ì •ë¦¬í•˜ê³ , ë‚¨ê¸¸ ê±´ ë‚¨ê¸°ê¸° ì¢‹ì•„ìš”."
  ],
  pi: [
    "ë¬´ë¦¬í•˜ì§€ ë§ê³  ë£¨í‹´ì„ ì§€í‚¤ë©´ ì•ˆì •ì ì´ì—ìš”.",
    "ì‘ê²Œ ìŒ“ëŠ” ê²Œ ì˜¤ëŠ˜ì˜ ìŠ¹ë¦¬ì…ë‹ˆë‹¤.",
    "ê°€ë²¼ìš´ ì‹¤í–‰ì´ í° ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ì¤„ì—¬ì¤˜ìš”."
  ],
  special: [
    "ì˜ˆìƒ ë°– ê¸°íšŒê°€ ë“¤ì–´ì˜¬ ìˆ˜ ìˆì–´ìš”.",
    "í•œ ë²ˆì˜ ì„ íƒì´ íŒì„ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    "í‹ˆìƒˆë¥¼ ë³´ë©´ ì˜¤ëŠ˜ì€ ê·¸ê²Œ ì •ë‹µì´ì—ìš”."
  ]
};

const themeHint = {
  ì‹œì‘: "ìƒˆë¡œ ì‹œì‘í•˜ê¸° ì¢‹ì€ íƒ€ì´ë°.",
  ê´€ê³„: "ì‚¬ëŒì—ì„œ ìš´ì´ íŠ¸ì´ëŠ” íë¦„.",
  ê¸°íšŒ: "ì‘ì€ ê¸°íšŒë¥¼ í¬ê²Œ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.",
  ì •ë¦¬: "ë¹„ìš°ë©´ ë‹¤ìŒì´ ë“¤ì–´ì˜µë‹ˆë‹¤.",
  ìŠ¹ë¶€: "ë°€ì–´ë¶™ì¼ ê±´ ë°€ì–´ë¶™ì´ê¸°.",
  í’ìš”: "ì—¬ìœ ê°€ ìƒê¸°ë©´ ë‚˜ëˆ”ë„ ì¢‹ì•„ìš”.",
  íšŒë³µ: "ì»¨ë””ì…˜ íšŒë³µì´ ìµœìš°ì„ .",
  ì§‘ì¤‘: "í•œ ê°€ì§€ì— ëª°ì…í•˜ë©´ ì„±ê³¼ê°€ ë‚©ë‹ˆë‹¤.",
  ì™„ì„±: "ë§ˆë¬´ë¦¬í•˜ë©´ í‰ê°€ê°€ ì¢‹ì•„ì ¸ìš”.",
  ì „í™˜: "ë£¨í‹´ì„ ë°”ê¾¸ë©´ ê¸°íšŒê°€ ì—´ë¦½ë‹ˆë‹¤.",
  í™•ì¥: "ìŠ¤ì¼€ì¼ì„ í‚¤ìš°ê¸° ì¢‹ì€ ë‚ .",
  ë§ˆë¬´ë¦¬: "ë§ˆì§€ë§‰ ì ê²€ì´ ì‹¤ìˆ˜ë¥¼ ë§‰ì•„ìš”."
};

function pickOne(arr, rng){
  return arr[Math.floor(rng()*arr.length)];
}

function makeFortune(card, isPractice=false){
  // practiceëŠ” ëœë¤
  const seed = hashString((isPractice? String(Math.random()) : todayKey()) + card.id);
  const rng = mulberry32(seed);

  const line1 = pickOne(fortuneBase[card.type] || fortuneBase.pi, rng);
  const line2 = themeHint[card.theme] || "ì˜¤ëŠ˜ íë¦„ì„ ê°€ë³ê²Œ ì½ì–´ë³´ì„¸ìš”.";

  // ì ìˆ˜ ê°ê°(ì¬ë¯¸ìš©)
  const scoreBase = {gwang: 82, special: 78, tti: 70, pi: 62};
  const score = Math.max(45, Math.min(95, (scoreBase[card.type]||60) + Math.floor(rng()*9)-4));

  // í–‰ë™ ì¶”ì²œ(ì§§ê²Œ)
  const actions = [
    "ê²°ì •í•´ì•¼ í•  ê±´ 1ê°œë§Œ ë¨¼ì €.",
    "ì˜¤ëŠ˜ì€ â€˜ë¹¨ë¦¬â€™ë³´ë‹¤ â€˜ì •í™•íˆâ€™.",
    "ëŒ€í™” í•˜ë‚˜ë§Œ ë” í•´ë³´ê¸°.",
    "30ë¶„ë§Œ ëª°ì…í•˜ê³  ëŠê¸°.",
    "ë¯¸ë£¨ë˜ ê²ƒ 1ê°œ ì •ë¦¬í•˜ê¸°."
  ];
  const action = pickOne(actions, rng);

  return { line1, line2, score, action };
}

/* =========================
   4) ê¸°ë¡(ìµœê·¼ 7ì¼)
========================= */
function loadHistory(){
  return JSON.parse(localStorage.getItem('hwatu.history')||'[]');
}
function saveHistory(list){
  localStorage.setItem('hwatu.history', JSON.stringify(list.slice(-7)));
}
function renderHistory(){
  const wrap = document.getElementById('history');
  const list = loadHistory().slice().reverse();
  wrap.innerHTML = '';
  if(list.length === 0){
    wrap.innerHTML = `<div class="hint">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”. ì˜¤ëŠ˜ í•œ ì¥ ë½‘ì•„ë³´ì„¸ìš”.</div>`;
    return;
  }
  list.forEach(item=>{
    const div = document.createElement('div');
    div.className = 'h-item';
    div.innerHTML = `
      <div class="left">
        <div class="date">${item.key}</div>
        <div class="name">${item.name}</div>
      </div>
      <div class="tag">${item.type.toUpperCase()} Â· ${item.theme}</div>
    `;
    wrap.appendChild(div);
  });
}

/* =========================
   5) UI ë°”ì¸ë”©
========================= */
const flip = document.getElementById('flip');
const cardImg = document.getElementById('cardImg');
const fallback = document.getElementById('fallback');
const imgPath = document.getElementById('imgPath');
const badges = document.getElementById('badges');
const resultTitle = document.getElementById('resultTitle');
const resultText = document.getElementById('resultText');
const drawBtn = document.getElementById('drawBtn');
const copyBtn = document.getElementById('copyBtn');
const rerollBtn = document.getElementById('rerollBtn');

let current = null;
let currentFortune = null;
let currentIsPractice = false;

function setBadges(card){
  const typeLabel = ({gwang:'ê´‘', tti:'ë ', pi:'í”¼', special:'íŠ¹ìˆ˜'})[card.type] || 'í”¼';
  badges.innerHTML = `
    <span class="badge">ğŸ“… ${card.monthName}</span>
    <span class="badge">ğŸ·ï¸ ${typeLabel}</span>
    <span class="badge">ğŸ§­ ${card.theme}</span>
  `;
}

function showCard(card){
  current = card;
  currentIsPractice = false;
  setBadges(card);

  // ì´ë¯¸ì§€ ë¡œë“œ
  cardImg.src = card.img;
  imgPath.textContent = card.img;

  cardImg.onload = () => {
    fallback.style.display = 'none';
    cardImg.style.display = 'block';
  };
  cardImg.onerror = () => {
    cardImg.style.display = 'none';
    fallback.style.display = 'block';
  };
}

function updateResult(card, fortune, isPractice){
  const mode = isPractice ? "ì—°ìŠµ ê²°ê³¼" : "ì˜¤ëŠ˜ì˜ ê²°ê³¼";
  resultTitle.textContent = `${mode} Â· ìš´ì„¸ ì ìˆ˜ ${fortune.score}ì `;
  resultText.innerHTML = `
    ${fortune.line1}<br/>
    <small>${fortune.line2}</small><br/>
    <small>ì˜¤ëŠ˜ì˜ ì œì•ˆ: <b>${fortune.action}</b></small>
  `;
  copyBtn.disabled = false;
}

function doDailyDraw(){
  const card = dailyPick();
  showCard(card);
  const f = makeFortune(card, false);
  currentFortune = f;

  // flip
  flip.classList.add('is-flipped');
  updateResult(card, f, false);

  // ê¸°ë¡ ì €ì¥
  const key = todayKey();
  const hist = loadHistory();
  const already = hist.find(x=>x.key===key);
  if(!already){
    hist.push({key, name: card.monthName, type: card.type, theme: card.theme, id: card.id});
    saveHistory(hist);
  }
  renderHistory();
}

function doPracticeDraw(){
  // ì—°ìŠµì€ ì™„ì „ ëœë¤
  const card = cards[Math.floor(Math.random()*cards.length)];
  currentIsPractice = true;
  showCard(card);
  const f = makeFortune(card, true);
  currentFortune = f;
  flip.classList.add('is-flipped');
  updateResult(card, f, true);
}

function copyResult(){
  if(!current || !currentFortune) return;
  const typeLabel = ({gwang:'ê´‘', tti:'ë ', pi:'í”¼', special:'íŠ¹ìˆ˜'})[current.type] || 'í”¼';
  const text =
`ğŸ´ í™”íˆ¬ ìš´ì„¸: ${current.monthName} (${typeLabel}/${current.theme})
ì ìˆ˜: ${currentFortune.score}ì 
í•œì¤„: ${currentFortune.line1}
ì œì•ˆ: ${currentFortune.action}
#í™”íˆ¬ìš´ì„¸ #funnyfunny #HwatuFortune`;

  navigator.clipboard.writeText(text)
    .then(()=> alert('ê²°ê³¼ê°€ ë³µì‚¬ëì–´ìš”! Xì— ë¶™ì—¬ë„£ê¸° í•˜ë©´ ë©ë‹ˆë‹¤.'))
    .catch(()=> alert('ë³µì‚¬ ì‹¤íŒ¨â€¦ ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ ì£¼ì„¸ìš”.'));
}

// ì´ˆê¸° ë Œë”
renderHistory();
showCard(dailyPick()); // ì¹´ë“œë§Œ ë¯¸ë¦¬ ì„¸íŒ…(ë’¤ì§‘ê¸° ì „)

// ì´ë²¤íŠ¸
drawBtn.addEventListener('click', doDailyDraw);
copyBtn.addEventListener('click', copyResult);
rerollBtn.addEventListener('click', doPracticeDraw);

// ì¹´ë“œ í´ë¦­í•˜ë©´ ì˜¤ëŠ˜ ìš´ì„¸ ì‹¤í–‰
flip.addEventListener('click', ()=>{
  // ì´ë¯¸ ë’¤ì§‘í˜”ë”ë¼ë„ ì˜¤ëŠ˜ ìš´ì„¸ëŠ” í•œë²ˆ ë” ëˆ„ë¥¼ ìˆ˜ ìˆê²Œ(ê²°ê³¼ ë™ì¼)
  doDailyDraw();
});
</script>
</body>
</html>
